<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>kvmial's blog</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="../res/layui/css/layui.css">
	<link rel="stylesheet" href="../res/static/css/mian.css">
    <link href="https://cdn.bootcss.com/highlight.js/9.12.0/styles/googlecode.min.css" rel="stylesheet">
	<link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
	<link href="../res/static/css/github-markdown.css" rel="stylesheet">
	<style>
		#page {
			text-align: center;
		}


		.header-wrap {
			display:flex;
			justify-content: space-between;
		}

		.header-right {
			display: flex;
			justify-content: space-between;
		}

		.header-right:first-child {
			margin-left:10px;
		}

		.header-right a {
			display: inline-block;
			color:#fff;
			width: 60px;
			text-align:center;

		}

		.header-right a:hover {
			background:rgb(59,89,152);
		}


		.logo-container {
			background: url("/res/static/images/logo3.png");
			width: 150px;
			height: 45px;
			background-size: contain;
			margin-top:40px;
			margin-bottom: 60px;

		}

        /*code {*/
            /*background: #f5f5f5 !important;*/
            /*font: 15px 'Courier';*/
        /*}*/
	</style>
</head>
<body class="lay-blog">
		<div class="header">
			<div class="header-wrap">
				<!--<h1 class="logo pull-left">-->
					<!--<a href="index.html">-->
						<!--<img src="../res/static/images/logo.png" alt="" class="logo-img">-->
						<!--<img src="../res/static/images/logo-text.png" alt="" class="logo-text">-->
					<!--</a>-->
				<!--</h1>-->
				<div class="blog-nav pull-left">
					<ul class="layui-nav pull-left">
						<li class="layui-nav-item layui-this"><a href="index.html">首页</a></li>
						<li class="layui-nav-item"><a href="message.html">留言</a></li>
						<li class="layui-nav-item"><a href="about.html">关于</a></li>
					</ul>

				</div>
				<div class="header-right">
				<form class="layui-form blog-seach " action="">
					<div class="layui-form-item blog-sewrap">
					    <div class="layui-input-block blog-sebox">
					      <i class="layui-icon layui-icon-search"></i>
					      <input type="text" name="title" lay-verify="title" autocomplete="off"  class="layui-input">
					    </div>
					</div>
				</form>

				<a href="" >
					<i class="fa fa-github"></i>
				</a>
				<a href="" class="">
					<i class="fa fa-envelope-o"></i>
				</a>
				</div>

				<!--移动端显示菜单的按钮-->
				<div class="mobile-nav pull-right" id="mobile-nav">
					<a href="javascript:;">
						<i class="layui-icon layui-icon-more"></i>
					</a>
				</div>
			</div>
			<ul class="pop-nav" id="pop-nav">
				<li><a href="index.html">首页</a></li>
				<li><a href="message.html">留言</a></li>
				<li><a href="about.html">关于</a></li>
			</ul>
		</div>
		<div class="container-wrap">
			<div class="container">
					<div class="contar-wrap">
						<p class="logo-container"></p>
						<hr>
						<h4 class="item-title">
							<p><i class="layui-icon layui-icon-speaker"></i>公告：<span>欢迎来到我的轻博客</span></p>
						</h4>

						<script type="text/html" id="postItem">
                            {{#  layui.each(d.data, function(index, item){ }}
                            <div class="item">
                                <div class="item-box  layer-photos-demo1 layer-photos-demo">
                                    <h3 class="post-title" style="font-size:25px"><a href="details.html">{{ item.title }}</a></h3>
                                    <h5>发布于：<span>刚刚</span></h5>
                                    <p class="post-text markdown-body" data-id="{{ item.id }}">父爱如山，不善表达。回想十多年前，总记得父亲有个宽厚的肩膀，小小的自己跨坐在上面，越过人山人海去看更广阔的天空，那个时候期望自己有一双翅膀，能够像鸟儿一样飞得高，看得远。虽然父亲有时会和自己开玩笑，但在做错事的时候会受到严厉的训斥。父亲有双粗糙的大手掌，手把手教我走路、骑车，却会在该放手的时刻果断地放开让自己去大胆尝试，那个时候期望快快长大，能够做自己想做的事，不用受父亲的“控制”。父亲是智慧树，他无所不知、无所不晓，虽然你有十万个为什么，但是也难不倒他。</p>
                                    <!--<img src="../res/static/images/item.png" alt="">-->
                                </div>
                                <div class="comment count">
                                    <a href="details.html#comment">评论</a>
                                    <a href="javascript:;" class="like">点赞</a>
                                </div>
                            </div>

                            {{#  }); }}
                            {{#  if(d.data.length === 0){ }}
                            无数据
                            {{#  } }}

                        </script>


                        <div id="view"></div>
						<!--<div class="item">-->
							<!--<div class="item-box  layer-photos-demo1 layer-photos-demo">-->
								<!--<h3 class="post-title"><a href="details.html">拥有诗意的心态,才能拥有诗意的生活</a></h3>-->
								<!--<h5>发布于：<span>刚刚</span></h5>-->
								<!--<p>父爱如山，不善表达。回想十多年前，总记得父亲有个宽厚的肩膀，小小的自己跨坐在上面，越过人山人海去看更广阔的天空，那个时候期望自己有一双翅膀，能够像鸟儿一样飞得高，看得远。虽然父亲有时会和自己开玩笑，但在做错事的时候会受到严厉的训斥。父亲有双粗糙的大手掌，手把手教我走路、骑车，却会在该放手的时刻果断地放开让自己去大胆尝试，那个时候期望快快长大，能够做自己想做的事，不用受父亲的“控制”。父亲是智慧树，他无所不知、无所不晓，虽然你有十万个为什么，但是也难不倒他。</p>-->
								<!--<img src="../res/static/images/item.png" alt="">-->
							<!--</div>-->
							<!--<div class="comment count">-->
								<!--<a href="details.html#comment">评论</a>-->
								<!--<a href="javascript:;" class="like">点赞</a>-->
							<!--</div>-->
						<!--</div>-->
					</div>

				<!--分页控件-->

					<div id="page"></div>

			</div>
		</div>
		<div class="footer">
			<p>
				<span>&copy; 2018</span>
				<span><a href="#" target="_blank">kvmial.cn</a></span>
				<span>蜀ICP备18026486号-1</span>
			</p>
			<p><span>All Rights Reserved</span></p>
		</div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/8.4.2/markdown-it.js"></script>
        <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
        <script src="../res/layui/layui.js"></script>
        <script th:inline="javascript">
            var currPage = [[${{currPage}}]];
            console.log("currPage" + currPage);
        </script>
        <script type="text/javascript">
        layui.config({
		  base: '../res/static/js/'
        }).use(['blog'],function () {
			var laypage = layui.laypage
				,form = layui.form;
			var $ = layui.jquery;
			var laytpl = layui.laytpl;
			// ajax请求数据
			$.ajax({
				method:"post",
				data:{
				    page:currPage,
					limit:2
				},
				url:"/listPosts",
				success:function (ret) {
					var limit = ret.limit;
					var count = ret.count;
                    laypage.render({
                        elem:'page',
						limit:limit,
						count:count,
                        curr:currPage,
                        jump: function (obj, first) {
                            if (!first) {
                                window.location.href="index?currPage=" + obj.curr;
                            }
                        }
                    });

					var data = ret.data;
                    for (var i = 0; i < data.length; i++) {
                        console.log(data[i].title);
					}

                    var getTpl = postItem.innerHTML
                        ,view = document.getElementById('view');
                    laytpl(getTpl).render(ret, function(html){
                        view.innerHTML = html;
                    });

                    $(".post-text").each(function () {
                        var id = $(this).data('id');
                        console.log(id);
                        var _this = this;
                        // ajax再请求markdown，然后用js渲染成html，再设置。
                        $.ajax({
                            method:'post',
                            url:'/getMarkdown',
                            async:false,
                            data:{
                                id:id
                            },
                            success: function (ret) {
                                console.log("ret::");
                                console.log(ret);
                                var md = window.markdownit();
                                var result = md.render(ret.data);
                                console.log(result);
                                $(_this).html(result);

                            },
                            error:function (ret) {
                                console.log(ret);
                            }
                        });
                    });
                    $('pre code').each(function(i, block) {
                        hljs.highlightBlock(block);
                    });
                }
			})

        });

	</script>
        <script>hljs.initHighlightingOnLoad(); console.log(hljs);</script>

</body>
</html>